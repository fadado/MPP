#!/bin/sh

# mpp - Markdown preprocessor

readonly PRELUDE="share/_prelude.mpp"
readonly INCLUDE="./share"
readonly ENVIRON="-DUID=$UID -DHOME=$HOME -DPWD='$PWD' -DLANG=$LANG -DPID=$$"

exec gpp \
    -U '${\W' '\W}' '\B' '\B' '\W}' '{' '}' '$' '' \
    +siis '<!--' '-->' ''       \
    +siis '`'  '`' ''           \
    +siis '\n```' '\n```' ''    \
    +siis '\n~~~' '\n~~~' ''    \
    +sccc '#|' '|#' ''          \
    +sccc '&\n' '' ''           \
    +siqi "'" "'" ''            \
    +siQi '"' '"' ''            \
    --warninglevel 2            \
    --nostdinc -I "$INCLUDE"    \
    --include "$PRELUDE"        \
    $ENVIRON -DNL="\n"          \
    -x -m "$@"

# vim:ts=4:sw=4:ai:et:fileencoding=utf-8:syntax=sh
